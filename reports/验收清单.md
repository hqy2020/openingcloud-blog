# 验收清单（Phase1-Phase3）

> 依据文档：`/Users/openingcloud/openingcloud-blog/assets/开发计划-TodoList.md`、`/Users/openingcloud/openingcloud-blog/assets/博客需求文档.md`  
> 当前验收环境：`http://47.99.42.71`  
> 沟通方式：你按编号反馈，我按编号修复
> UX 清单入口：`/Users/openingcloud/openingcloud-blog/reports/用户体验验收清单.md`

## 状态说明

- `已完成`：代码已实现，当前环境可验。
- `未完成`：尚未实现、仅部分实现，或环境侧尚未打通。

---

## 一、已完成（可立即验收）

## Phase 1

- [x] `P1-BE-01` 后端基础链路可用（Django + DRF + SQLite）  
验收：访问 `http://47.99.42.71/api/health` 返回 `ok=true`。

- [x] `P1-BE-02` 7 张核心业务表模型已落地  
验收：服务器执行 `python manage.py showmigrations blog`，可见 `0001_initial`、`0002_socialfriend_stage_key` 已应用。

- [x] `P1-BE-03` Django Admin 能力集成（排序/Inline/Dashboard）  
验收：服务器执行 `python manage.py verify_admin_capabilities` 返回通过。

- [x] `P1-BE-04` JWT Cookie 鉴权链路已实现（login/logout/me/admin ping）  
验收：接口存在：`/api/auth/login`、`/api/auth/logout`、`/api/auth/me`、`/api/admin/ping`。

- [x] `P1-BE-05` CSRF + CORS + Origin/Referer 校验中间件已启用  
验收：服务器执行 `python manage.py security_baseline_check --allow-http-temporary` 返回通过。

- [x] `P1-API-01` 基础公开 API 已上线  
验收：`/api/posts/`、`/api/posts/{slug}/`、`/api/posts/{slug}/view/` 均可访问（有数据时验证详情和阅读数）。

- [x] `P1-DATA-01` Markdown 导入命令已实现  
验收：执行 `python manage.py import_posts <path> --dry-run` 可输出待导入结果。

- [x] `P1-DATA-02` 结构化数据导入命令已实现  
验收：执行 `python manage.py import_structured_data backend/fixtures/phase1_seed.template.json --dry-run` 可输出统计。

- [x] `P1-FE-01` 前端基础路由骨架已上线  
验收：`/`、`/tech/`、`/learning/`、`/life/`、`/posts/:slug` 路由可访问。

- [x] `P1-DEP-01` Docker Compose 双容器部署可用  
验收：服务器执行 `docker compose ps`，`backend` 与 `nginx` 都是 `Up`。

- [x] `P1-DEP-02` Nginx 反代链路可用（`/`、`/api/`、`/admin/`）  
验收：访问 `http://47.99.42.71/`、`http://47.99.42.71/api/health`、`http://47.99.42.71/admin/`。

- [x] `P1-CI-01` GitHub Actions 构建/部署流水线文件已配置  
验收：查看 `.github/workflows/deploy.yml` 存在并可被 `push main` 触发。

- [x] `P1-POC-01` SQLite 并发写压测能力已实现  
验收：执行 `python manage.py sqlite_write_stress_test --concurrency 10 --rounds 20 --strict`，无 `database is locked`。

- [x] `P1-POC-02` 安全基线校验命令已接入  
验收：`security_baseline_check` 可执行且输出检查项。

## Phase 2

- [x] `P2-API-01` 首页聚合接口 `GET /api/home/`  
验收：访问 `http://47.99.42.71/api/home/`，返回 `ok=true` 且包含 `hero/timeline/highlights/travel/social_graph/stats/contact`。

- [x] `P2-API-02` 模块公开接口已上线  
验收：访问  
`http://47.99.42.71/api/timeline/`  
`http://47.99.42.71/api/highlights/`  
`http://47.99.42.71/api/travel/`  
`http://47.99.42.71/api/social-graph/`  
均返回 `ok=true`。

- [x] `P2-API-03` 社交图谱匿名化返回  
验收：`/api/social-graph/` 返回中不应出现 `name/profile_url/avatar`。

- [x] `P2-API-04` `SocialFriend.stage_key` 字段已生效  
验收：后台 `SocialFriend` 可看到并编辑 `stage_key`。

- [x] `P2-API-05` 后端 Sitemap 功能已实现  
验收：代码存在 `blog/sitemaps.py`，后端测试通过（见 `blog/tests.py` sitemap 用例）。

- [x] `P2-FE-01` 首页七大板块已接入统一数据源  
验收：访问 `http://47.99.42.71/`，可看到 Hero、人生足迹、高光时刻、旅行足迹、社交图谱、数据面板、联系方式。

- [x] `P2-FE-02` 分类页功能可用（双列+标签筛选）  
验收：访问  
`http://47.99.42.71/tech/`  
`http://47.99.42.71/learning/`  
`http://47.99.42.71/life/`  
标签筛选可点击。

- [x] `P2-FE-03` 文章详情页能力可用  
验收：从分类页进入详情，确认 Markdown 渲染、目录、阅读进度条可用。

- [x] `P2-FE-04` 旅行足迹展示可用  
验收：首页旅行板块可展示地图或降级卡片（至少一种可用）。

- [x] `P2-FE-05` 社交图谱展示可用  
验收：首页社交图谱可展示阶段与匿名节点，页面无报错。

- [x] `P2-SEO-01` `robots.txt` 已发布  
验收：访问 `http://47.99.42.71/robots.txt`。

- [x] `P2-SEO-02` 页面 Meta 标签已接入  
验收：查看首页/分类页/详情页源码，存在 title/description/og/canonical。

- [x] `P2-SEO-03` 预渲染产物已生成（`/`、`/tech`、`/learning`、`/life`）  
验收：查看 `http://47.99.42.71/tech/` 源码，存在预渲染标题和 `noscript data-prerender-route`。

## Phase 3（已落地部分）

- [x] `P3-PET-01` 草地宠物状态机基础实现  
验收：首页点击后可观察 `idle -> walking_to_grass -> eating -> idle`。

- [x] `P3-PET-02` 动画降级策略已实现  
验收：在 `prefers-reduced-motion` 或低内存设备下可自动禁用宠物交互。

- [x] `P3-SYNC-01` `sync_obsidian` 命令已实现  
验收：执行  
`python manage.py sync_obsidian <vault_path> --dry-run`  
`python manage.py sync_obsidian <vault_path> --force`  
命令可执行并输出统计。

- [x] `P3-SYNC-02` 冲突模式参数已支持  
验收：`--mode=overwrite|skip|merge` 可正常识别。

---

## 二、未完成（当前验收会失败或仅部分通过）

## Phase 1

- [ ] `P1-MILE-01` 正式 HTTPS 可访问（域名 + 证书）  
状态：未完成。`https://blog.openingclouds.com/` 当前不可用。

- [ ] `P1-MILE-02` 历史业务数据迁移完成  
状态：未完成。当前线上 `timeline/highlights/travel` 仍为空或非完整生产数据。

- [ ] `P1-MILE-03` 生产安全基线严格模式  
状态：未完成。当前仍为临时 HTTP 基线（`DEBUG/COOKIE/CORS` 非生产严模式）。

- [ ] `P1-MILE-04` 24h 稳定性与内存观测  
状态：未完成。尚未形成连续 24h 监控记录和阈值证明。

- [x] `P1-MILE-05` Admin 静态资源完整可用  
状态：代码已修复。Nginx 改为静态目录直出 `/static/`，发布后按 `/static/admin/*` 复验。

## Phase 2

- [x] `P2-API-06` 媒体上传接口 `POST /api/admin/images/`  
状态：已实现。支持 `multipart/form-data`（字段 `file`）、`jpg/png/webp`、`<=5MB`，并返回 `url/path/size/content_type`。

- [x] `P2-UI-01` Aceternity UI 组件迁移（BackgroundBeams/CardSpotlight/TextGenerateEffect）  
状态：已完成。组件落地于 `frontend/src/components/ui/` 并接入首页/分类页。

- [x] `P2-UI-02` Motion 动画体系完整迁移（FadeIn/StaggerContainer/ScrollReveal/ParallaxSection）  
状态：已完成。组件落地于 `frontend/src/components/motion/` 并接入首页与分类页。

- [x] `P2-HERO-01` Hero R3F 云海穿越正式方案  
状态：已完成。R3F 云海场景（Cloud/Sparkles/GodRay + 相机推进）已接入，保留移动端与低性能降级 fallback。

- [x] `P2-SEO-04` 线上 `sitemap.xml` 网关转发正确性  
状态：代码已修复。Nginx 新增 `location = /sitemap.xml` 直通后端；发布后在线复验。

- [x] `P2-QA-01` Lighthouse 移动端 `>=75` 正式验收报告  
状态：已完成。报告见 `reports/lighthouse-mobile.json` 与 `reports/lighthouse-mobile.md`（Performance=80）。

## Phase 3

- [x] `P3-SYNC-03` 同步 API `POST /api/admin/obsidian-sync/`  
状态：已实现。接口路径 `/api/admin/obsidian-sync/`，支持 `overwrite|skip|merge`。

- [x] `P3-SYNC-04` 持久化同步日志（SyncLog 模型或等效）  
状态：已实现。新增 `SyncLog` 模型与 Admin 只读视图，命令/API 统一写入日志。

- [ ] `P3-OPS-01` 自动备份策略落地（cron 每日 + 保留 7 天）  
状态：脚本存在，服务器定时任务未完成验收。

- [ ] `P3-OPS-02` 每月恢复演练记录  
状态：未执行。

- [ ] `P3-OPS-03` Nginx/Gunicorn 日志轮转（单文件 <= 100MB）  
状态：未完成。

- [ ] `P3-OPS-04` 30 秒内回滚能力验证  
状态：未完成。

- [ ] `P3-OPS-05` 连续 7 天稳定性观测（内存 < 60%）  
状态：未完成。

---

## 三、沟通格式（请直接复制修改后发我）

- 已通过：`P1-BE-01, P2-API-01, P2-FE-01`
- 有问题：`P2-FE-03`（现象 + 设备/浏览器）
- 暂不验：`P3-OPS-05`

我会按你给的编号逐项修复和回报。
