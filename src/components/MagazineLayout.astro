---
/**
 * MagazineLayout â€” æ‚å¿—å¼ç¼–è¾‘æ’ç‰ˆ
 * å¤§å·é¦–ç¯‡ + å·¦å³äº¤æ›¿çš„æ–‡ç« æ¡ç›®ï¼ŒGSAP stagger å…¥åœº + glow-border æ‚¬æµ®
 */
interface Props {
  posts: Array<{
    title: string;
    description?: string;
    date: Date;
    category: string;
    tags?: string[];
    cover?: string;
    slug: string;
  }>;
  title: string;
  subtitle?: string;
}

const { posts, title, subtitle } = Astro.props;
const featured = posts[0];
const rest = posts.slice(1);

const categoryLabels: Record<string, string> = {
  journal: 'ğŸ““ æ—¥è®°', tech: 'ğŸ’» æŠ€æœ¯', learning: 'ğŸ“š æ•ˆç‡', life: 'ğŸ“· ç”Ÿæ´»',
};

function formatDate(d: Date) {
  return new Date(d).toLocaleDateString('zh-CN', { year: 'numeric', month: 'long', day: 'numeric' });
}
---

<div>
  <!-- é¡µé¢æ ‡é¢˜ -->
  <header class="mb-10" data-gsap-fade>
    <h1 class="text-editorial-xl text-slate-800 dark:text-slate-100">{title}</h1>
    {subtitle && <p class="text-lg text-slate-500 dark:text-slate-400 mt-2">{subtitle}</p>}
    <div class="mt-4 h-1 w-16 bg-gradient-to-r from-primary-400 to-primary-300 rounded-full"></div>
  </header>

  {posts.length === 0 ? (
    <p class="text-slate-400 text-center py-16">æš‚æ— æ–‡ç« ï¼Œå¿«å»å†™ä½œå§ï¼</p>
  ) : (
    <div data-gsap-stagger>
      {/* å°é¢æ•…äº‹ â€” é¦–ç¯‡å¤§å¡ */}
      {featured && (
        <a
          href={`/posts/${featured.slug}/`}
          class="group block mb-8 rounded-2xl overflow-hidden glow-border bg-white dark:bg-slate-800 transition-all duration-300 hover:-translate-y-0.5"
          style={`view-transition-name: post-${featured.slug.replace(/\//g, '-')}`}
        >
          <div class="md:flex">
            {featured.cover && (
              <div class="md:w-1/2 overflow-hidden">
                <img
                  src={featured.cover}
                  alt={featured.title}
                  class="w-full h-56 md:h-72 object-cover group-hover:scale-105 transition-transform duration-700"
                  loading="lazy"
                />
              </div>
            )}
            <div class:list={['p-6 md:p-8 flex flex-col justify-center', featured.cover ? 'md:w-1/2' : 'w-full']}>
              <div class="flex items-center gap-2 mb-3">
                <span class="text-xs font-medium px-2.5 py-1 rounded-full bg-grass-50 text-grass-600 dark:bg-grass-700/20 dark:text-grass-300">
                  {categoryLabels[featured.category] || featured.category}
                </span>
                <time class="text-xs text-slate-400">{formatDate(featured.date)}</time>
              </div>
              <h2 class="text-2xl md:text-3xl font-bold text-slate-800 dark:text-slate-100 group-hover:text-primary-500 transition-colors mb-3 leading-tight line-clamp-2 font-display">
                {featured.title}
              </h2>
              {featured.description && (
                <p class="text-slate-500 dark:text-slate-400 line-clamp-3">{featured.description}</p>
              )}
              {featured.tags && featured.tags.length > 0 && (
                <div class="flex flex-wrap gap-1.5 mt-4">
                  {featured.tags.slice(0, 4).map(tag => (
                    <span class="text-xs px-2 py-0.5 rounded-md bg-slate-100 text-slate-500 dark:bg-slate-700 dark:text-slate-400">
                      #{tag}
                    </span>
                  ))}
                </div>
              )}
            </div>
          </div>
        </a>
      )}

      {/* å…¶ä½™æ–‡ç«  â€” äº¤æ›¿æ’ç‰ˆ */}
      <div class="space-y-4">
        {rest.map((post, i) => (
          <a
            href={`/posts/${post.slug}/`}
            class:list={[
              'group flex flex-col md:flex-row items-stretch rounded-xl glow-border bg-white dark:bg-slate-800 overflow-hidden transition-all duration-300 hover:-translate-y-0.5',
              i % 2 === 1 && 'md:flex-row-reverse',
            ]}
            style={`view-transition-name: post-${post.slug.replace(/\//g, '-')}`}
          >
            {post.cover && (
              <div class="md:w-2/5 overflow-hidden shrink-0">
                <img
                  src={post.cover}
                  alt={post.title}
                  class="w-full h-40 md:h-full object-cover group-hover:scale-105 transition-transform duration-500"
                  loading="lazy"
                />
              </div>
            )}
            <div class="p-5 md:p-6 flex flex-col justify-center flex-1">
              <div class="flex items-center gap-2 mb-2">
                <span class="text-xs font-medium px-2 py-0.5 rounded-full bg-grass-50 text-grass-600 dark:bg-grass-700/20 dark:text-grass-300">
                  {categoryLabels[post.category] || post.category}
                </span>
                <time class="text-xs text-slate-400">{formatDate(post.date)}</time>
              </div>
              <h3 class="text-lg font-bold text-slate-800 dark:text-slate-100 group-hover:text-primary-500 transition-colors line-clamp-2 mb-1">
                {post.title}
              </h3>
              {post.description && (
                <p class="text-sm text-slate-500 dark:text-slate-400 line-clamp-2">{post.description}</p>
              )}
              {post.tags && post.tags.length > 0 && (
                <div class="flex flex-wrap gap-1 mt-3">
                  {post.tags.slice(0, 3).map(tag => (
                    <span class="text-xs px-2 py-0.5 rounded-md bg-slate-100 text-slate-500 dark:bg-slate-700 dark:text-slate-400">
                      #{tag}
                    </span>
                  ))}
                </div>
              )}
            </div>
          </a>
        ))}
      </div>
    </div>
  )}
</div>
