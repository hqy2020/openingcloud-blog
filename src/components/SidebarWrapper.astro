---
/**
 * Sidebar Astro wrapper — 获取数据后传入 React Sidebar
 */
import { getCollection } from 'astro:content';
import { Sidebar } from '@/react/layout/Sidebar';

const allCollections = await Promise.all([
  getCollection('journal', ({ data }) => !data.draft),
  getCollection('tech', ({ data }) => !data.draft),
  getCollection('learning', ({ data }) => !data.draft),
  getCollection('life', ({ data }) => !data.draft),
]);

const allPosts = allCollections.flat();
const totalPosts = allPosts.length;

// 统计标签频率
const tagCount = new Map<string, number>();
for (const post of allPosts) {
  for (const tag of post.data.tags) {
    tagCount.set(tag, (tagCount.get(tag) || 0) + 1);
  }
}

const sortedTags = [...tagCount.entries()]
  .sort((a, b) => b[1] - a[1])
  .map(([tag, count]) => ({ tag, count }));

const totalTags = sortedTags.length;
---

<Sidebar
  client:visible
  totalPosts={totalPosts}
  totalTags={totalTags}
  tags={sortedTags}
/>
