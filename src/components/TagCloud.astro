---
/**
 * æ ‡ç­¾äº‘ç»„ä»¶
 * æ”¶é›†æ‰€æœ‰æ–‡ç« çš„æ ‡ç­¾ï¼ŒæŒ‰å‡ºç°é¢‘ç‡æ’åº
 */
import { getCollection } from 'astro:content';

const allCollections = await Promise.all([
  getCollection('journal', ({ data }) => !data.draft),
  getCollection('tech', ({ data }) => !data.draft),
  getCollection('learning', ({ data }) => !data.draft),
  getCollection('life', ({ data }) => !data.draft),
]);

const allPosts = allCollections.flat();

// ç»Ÿè®¡æ ‡ç­¾é¢‘ç‡
const tagCount = new Map<string, number>();
for (const post of allPosts) {
  for (const tag of post.data.tags) {
    tagCount.set(tag, (tagCount.get(tag) || 0) + 1);
  }
}

// æŒ‰é¢‘ç‡æ’åº
const sortedTags = [...tagCount.entries()].sort((a, b) => b[1] - a[1]);
---

{sortedTags.length > 0 && (
  <div class="bg-white dark:bg-slate-800 rounded-xl border border-slate-200 dark:border-slate-700 p-4">
    <h3 class="text-sm font-semibold text-slate-700 dark:text-slate-200 mb-3">ğŸ·ï¸ æ ‡ç­¾</h3>
    <div class="flex flex-wrap gap-2">
      {sortedTags.map(([tag, count]) => (
        <a
          href={`/tags/${tag}/`}
          class="text-xs px-2.5 py-1 rounded-full bg-slate-100 dark:bg-slate-700 text-slate-600 dark:text-slate-300 hover:bg-primary-100 hover:text-primary-600 dark:hover:bg-primary-900/30 dark:hover:text-primary-300 transition-colors"
        >
          #{tag}
          <span class="ml-0.5 text-slate-400 dark:text-slate-500">({count})</span>
        </a>
      ))}
    </div>
  </div>
)}
