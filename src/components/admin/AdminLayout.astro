---
import '@/styles/global.css';

interface Props {
  title: string;
}

const { title } = Astro.props;
const currentPath = Astro.url.pathname;

const navGroups = [
  {
    label: 'å†…å®¹ç®¡ç†',
    items: [
      { href: '/admin/posts', label: 'ğŸ“ æ–‡ç« ç®¡ç†' },
      { href: '/admin/posts/new', label: 'âœï¸ æ–°å»ºæ–‡ç« ' },
      { href: '/admin/media', label: 'ğŸ–¼ï¸ å›¾ç‰‡ç®¡ç†' },
    ],
  },
  {
    label: 'æ•°æ®ç®¡ç†',
    items: [
      { href: '/admin/diary', label: 'ğŸ“Š æ—¥è®°æ•°æ®' },
      { href: '/admin/timeline', label: 'ğŸ—ºï¸ äººç”Ÿè·¯çº¿' },
    ],
  },
];
---

<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <title>{title} | å¯äº‘åå°</title>
    <script is:inline>
      if (localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
        document.documentElement.classList.add('dark');
      }
    </script>
  </head>
  <body class="min-h-screen bg-bg-light dark:bg-bg-dark text-text-light dark:text-text-dark">
    <!-- é¡¶éƒ¨å¯¼èˆª -->
    <header class="bg-card-light dark:bg-card-dark border-b border-gray-200 dark:border-gray-700 sticky top-0 z-50">
      <div class="max-w-7xl mx-auto px-4 h-14 flex items-center justify-between">
        <div class="flex items-center gap-6">
          <a href="/admin" class="font-bold text-primary-500">å¯äº‘åå°</a>
          <nav class="hidden sm:flex items-center gap-1">
            {navGroups.map((group, gi) => (
              <>
                {gi > 0 && <span class="text-gray-300 dark:text-gray-600 mx-1">|</span>}
                {group.items.map(({ href, label }) => (
                  <a
                    href={href}
                    class:list={[
                      'text-sm px-2 py-1 rounded transition-colors',
                      currentPath.startsWith(href)
                        ? 'text-primary-500 font-medium bg-primary-50 dark:bg-primary-900/20'
                        : 'text-gray-600 dark:text-gray-400 hover:text-primary-500 hover:bg-gray-100 dark:hover:bg-gray-800',
                    ]}
                  >
                    {label}
                  </a>
                ))}
              </>
            ))}
          </nav>
        </div>
        <div class="flex items-center gap-3">
          <a href="/" class="text-sm text-gray-500 hover:text-primary-500">æŸ¥çœ‹åšå®¢</a>
          <button id="admin-logout-btn" class="text-sm text-red-500 hover:text-red-600 cursor-pointer">é€€å‡º</button>
        </div>
      </div>
    </header>

    <!-- å†…å®¹åŒº -->
    <main class="max-w-7xl mx-auto px-4 py-6">
      <slot />
    </main>

    <script is:inline>
      document.getElementById('admin-logout-btn')?.addEventListener('click', async () => {
        await fetch('/api/admin/auth/logout', { method: 'POST' });
        window.location.href = '/admin/login';
      });
    </script>
  </body>
</html>
