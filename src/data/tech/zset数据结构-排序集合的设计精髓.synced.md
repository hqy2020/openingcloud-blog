---
title: "ZSet数据结构-排序集合的设计精髓"
description: "Redis ZSet 三元组理解与跳表设计精髓，附排行榜实战代码"
date: 2026-02-04
category: tech
tags: [Redis, 数据结构]
---

# ZSet数据结构-排序集合的设计精髓

## 定义
> Redis ZSet（Sorted Set）是一种同时支持 O(1) 成员存在性判断和 O(log n) 范围查询的数据结构，底层由 dict（哈希表）+ skiplist（跳表）组成。

## 核心要点

### 三元组理解
- **Key**：ZSet 的名称，全局唯一（类比：文件夹名）
- **Member**：集合中的元素，同一 Key 下唯一（类比：文件夹内的文件）
- **Score**：元素的分数，用于排序（类比：文件上的标签数字）

```java
// 示例：存储用户1001的优惠券列表
stringRedisTemplate.opsForZSet().add(
    "user_coupon_list_1001",  // Key
    "2001_5001",               // Member（券模板ID_用户券ID）
    1707000000000              // Score（领取时间戳）
);
```

### 为什么用跳表而不是红黑树

| 对比项 | 红黑树 | 跳表 |
|-------|-------|------|
| 时间复杂度 | O(log n) | O(log n) |
| 实现复杂度 | 高（旋转、变色） | 低（随机层数） |
| 范围查询 | 需中序遍历 | 直接遍历链表 |
| 并发友好 | 差（整棵树加锁） | 好（只锁局部） |

跳表结构示意：
```
Level 3:  1 -----------------> 9
Level 2:  1 -------> 5 ------> 9
Level 1:  1 --> 3 -> 5 -> 7 -> 9
Level 0:  1 -> 2 -> 3 -> 4 -> 5 -> 6 -> 7 -> 8 -> 9
```

### 重复规则

- Key 不能重复：全局唯一标识
- Member 不能重复（同一 Key 下）：再次 add 相同 Member 会**更新 Score**

## 与其他概念的关系
- [Redis List](/posts/redis-list)：无排序功能，无法按分数范围查询
- [Redis Set](/posts/redis-set)：无排序功能，但同样支持 O(1) 判断存在
- [跳表](/posts/跳表)：ZSet 的底层实现之一

## 应用场景
- 排行榜（按分数排序）
- 用户优惠券列表（按领取时间排序）
- 延时队列（按执行时间排序）
- 带权重的任务调度

## 参考来源
- 《牛券oneCoupon优惠券系统设计》第23小节
- Redis 官方文档
