---
export const prerender = false;
/**
 * 人生路线 — 横向卷轴时间线（React 版）
 */
import BaseLayout from '@/layouts/BaseLayout.astro';
import { HorizontalTimeline } from '@/react/sections/HorizontalTimeline';
import { FadeIn } from '@/react/motion/FadeIn';

interface TimelineNode {
  id: number;
  title: string;
  description: string | null;
  start_date: string;
  end_date: string | null;
  type: string;
  impact: string;
  phase: string | null;
  tags: string;
  cover: string | null;
}

let nodes: TimelineNode[] = [];

try {
  const db = Astro.locals.runtime.env.BLOG_DB;
  const rows = await db
    .prepare('SELECT id, title, description, start_date, end_date, type, impact, phase, tags, cover FROM timeline_nodes ORDER BY start_date ASC, sort_order ASC')
    .all();
  nodes = rows.results as TimelineNode[];
} catch {
  // Table may not exist yet
}

// Serialize tags from JSON string to array
const serializedNodes = nodes.map(n => ({
  ...n,
  tags: JSON.parse(n.tags || '[]') as string[],
}));
---

<BaseLayout title="人生路线" sidebar={false} fullWidth={true}>
  <div class="text-center py-10">
    <FadeIn client:load>
      <h1 class="text-3xl font-bold mb-2 font-display">🗺️ 人生路线</h1>
      <p class="text-slate-500 dark:text-slate-400 text-sm">一步一个脚印，记录成长轨迹</p>
    </FadeIn>
  </div>

  {serializedNodes.length === 0 ? (
    <div class="text-center py-16 text-slate-400 max-w-3xl mx-auto">
      <p class="text-lg mb-2">暂无时间线数据</p>
      <p class="text-sm">在后台<a href="/admin/timeline" class="text-primary-500 hover:underline">添加人生节点</a>后，这里会展示时间轴</p>
    </div>
  ) : (
    <HorizontalTimeline client:load nodes={serializedNodes} />
  )}
</BaseLayout>
